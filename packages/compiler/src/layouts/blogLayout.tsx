// @ts-nocheck -- jsx hastscript types don't work with hast??
import { select } from "hast-util-select";
import { h } from "hastscript";
import { VFile } from "vfile";

export default function blogLayout(tree: ReturnType<typeof h>, file: VFile) {
  const body = select("body", tree);
  if (!body) {
    throw new Error(
      "Body is required to exist before applying the default layout"
    );
  }
  const newChildren = [body.children];
  const matter = file.data.matter;
  const maybeDate = file.basename?.substring(0, 10);
  if (/[0-9]{4}-[0-9]{2}-[0-9]{2}/.exec(maybeDate)) {
    newChildren.unshift(
      <span class="published subtext">Published {maybeDate}</span>
    );
  }
  if (matter?.title) {
    newChildren.unshift(<h1>{matter?.title}</h1>);
  }
  body.children = [
    <svg
      xmlns="http://www.w3.org/2000/svg"
      style="position:absolute;visibility:hidden;opacity:0;margin:0;padding:0;width:0;height:0"
    >
      <symbol id="icon-logo-dark">
        <path d="m501.67 420.7v-269.03c0.13672-40.262-15.824-78.906-44.336-107.34-95.082-95.082-259-27.184-259 107.34 0 358.98 1.8672 236.37-8.2852 299.95l-15.047 94.848c-1.0312 6.4453 3.3555 12.504 9.8008 13.535 6.4414 1.0312 12.5-3.3555 13.531-9.8008 15.285-97.301 14.234-125.54 46.668-163.33v29.867c-6.9258 11.605-10.582 24.867-10.582 38.383 0 13.516 3.6562 26.777 10.582 38.383v54.832c0 6.4453 5.2227 11.668 11.668 11.668 6.4414 0 11.664-5.2227 11.664-11.668v-58.332c0-7.6992-10.617-14-10.617-35s10.617-27.766 10.617-35v-48.883c29.453 38.074 74.832 60.422 122.97 60.551h45.383c15.867 31.266-5.0156 50.285-5.0156 58.332v58.332c0 6.4453 5.2227 11.668 11.664 11.668 6.4453 0 11.668-5.2227 11.668-11.668v-54.949c7.2812-12.117 10.961-26.055 10.609-40.188-0.35156-14.133-4.7188-27.871-12.594-39.613-4.5508-7-6.1836-5.25-61.715-5.25-41.891-0.16406-81.227-20.156-106.05-53.898 44.566-23.332 41.418 3.1484 41.418-53.668 15.371 3.3867 31.293 3.3867 46.664 0v30.102c-0.14453 5.5273 3.6055 10.398 8.9844 11.668 26.746 6.3359 51.004 20.477 69.695 40.625 18.695 20.148 30.984 45.398 35.305 72.539l14.352 94.5c1.0312 6.4453 7.0898 10.832 13.531 9.8008 6.4453-1.0312 10.832-7.0898 9.8008-13.535-16.102-101.5-15.633-105-23.332-125.77zm-120.98-146.65c-25.184 10.207-53.793 7.2227-76.324-7.9609-22.531-15.188-36.039-40.586-36.027-67.758v-35c17.402-1.9766 33.898-8.8086 47.602-19.715 38.148 24.965 75.25 27.648 115.73 21.934v32.781c0.003906 16.266-4.8438 32.156-13.926 45.648-9.0859 13.488-21.988 23.961-37.059 30.07zm15.984 47.832v-30.215c17.406-8.6367 32.074-21.934 42.375-38.414 10.297-16.477 15.824-35.488 15.957-54.922v-46.664c0.035156-3.4023-1.418-6.6445-3.9727-8.8867-2.5547-2.2422-5.9609-3.2578-9.3281-2.7812l-23.918 3.3828h0.003906c-33.902 4.6172-68.266-4.1719-95.785-24.5-15.633-11.668-20.766 21-63.352 21-13.648 0.11719-13.648 10.617-13.648 11.785v46.668-0.003907c0.13281 19.434 5.6602 38.445 15.957 54.922 10.301 16.48 24.969 29.777 42.375 38.414v29.75c-32.586 9.6758-61.207 29.551-81.664 56.699v-226.45c0-45.852 24.457-88.215 64.164-111.14 39.707-22.926 88.629-22.926 128.34 0 39.707 22.926 64.164 65.289 64.164 111.14v226.8c-20.574-26.996-49.16-46.801-81.664-56.582z" />
        <path d="m109.08 170.1c-2.5938 5.1406-3.9883 10.805-4.082 16.566-12.504 0-24.059 6.668-30.312 17.5-6.25 10.828-6.25 24.168 0 35 6.2539 10.828 17.809 17.5 30.312 17.5h58.332c3.0938 0 6.0625-1.2305 8.25-3.418s3.418-5.1562 3.418-8.25v-58.332c0.046875-10.512-4.6289-20.488-12.738-27.172-8.1133-6.6836-18.797-9.3711-29.105-7.3164-10.309 2.0586-19.145 8.6367-24.074 17.922zm42.586 63.23c-50.633 0-50.398 1.168-54.949-3.3828h-0.003906c-2.6289-2.5859-3.8828-6.2656-3.3789-9.918 0.50781-3.6562 2.7109-6.8555 5.9492-8.6328 3.6133-1.3984 5.7148-1.3984 17.383-1.3984 3.0938 0 6.0586-1.2305 8.25-3.418 2.1875-2.1875 3.4141-5.1562 3.4141-8.25 0-10.617-1.0508-15.633 3.3828-19.949 3.5352-3.3359 8.6914-4.293 13.184-2.4492 8.6367 3.1484 6.7695 9.6836 6.7695 57.398z" />
        <path d="m611.57 62.418c-5.1445-2.5938-10.809-3.9922-16.566-4.0859 0-45.5-70-46.668-70 0v58.336c0 3.0938 1.2305 6.0586 3.418 8.25 2.1875 2.1875 5.1562 3.4141 8.25 3.4141h58.332c10.512 0.050781 20.484-4.6289 27.172-12.738 6.6836-8.1133 9.3672-18.797 7.3125-29.105-2.0547-10.309-8.6328-19.145-17.918-24.07zm-8.2852 39.199c-4.5469 4.5508-4.1992 3.3828-54.949 3.3828 0-47.484-1.9844-54.25 6.7656-57.398h0.003906c4.4922-1.8438 9.6484-0.88672 13.184 2.4492 4.082 4.082 3.3828 7 3.3828 19.949 0 3.0938 1.2266 6.0625 3.4141 8.25 2.1914 2.1875 5.1562 3.418 8.25 3.418 12.832 0 14.117 0 17.148 1.2852l0.003906-0.003906c3.3125 1.7227 5.6016 4.9297 6.1523 8.6211 0.55469 3.6914-0.69141 7.4258-3.3516 10.047z" />
      </symbol>
    </svg>,
    <header id="header">
      <a href="/aphrodite" class="logo">
        <img src="logos/aphrodite.png"></img>
        <div class="logo-subtext">
          <span>B</span>
          <span>e</span>
          <span>a</span>
          <span>u</span>
          <span>t</span>
          <span>i</span>
          <span>f</span>
          <span>u</span>
          <span>l</span> <span>S</span>
          <span>c</span>
          <span>h</span>
          <span>e</span>
          <span>m</span>
          <span>a</span>
          <span>s</span>
        </div>
      </a>
    </header>,
    <div id="static-container">
      <div id="before-static"></div>
      <main id="static">{newChildren}</main>
      <div id="after-static"></div>
    </div>,
    <footer id="footer"></footer>,
  ];
}
